# 多语言和支付功能测试指南

## 概述

本文档提供了八字算命应用多语言支持和支付系统的测试指南，包括测试用例、测试步骤和预期结果。

## 多语言功能测试

### Flutter移动端多语言测试

#### 测试用例1：语言切换功能
**测试步骤：**
1. 打开Flutter应用
2. 点击导航栏中的语言切换按钮
3. 在弹出的语言选择菜单中，选择"English"
4. 验证界面文本是否切换为英文
5. 再次点击语言切换按钮，选择"中文"
6. 验证界面文本是否切换回中文

**预期结果：**
- 应用界面文本应正确切换到所选语言
- 所有按钮、标签、提示信息都应显示为正确的语言
- 语言设置应保持到下次启动应用

#### 测试用例2：支付相关多语言测试
**测试步骤：**
1. 确保应用语言为中文
2. 导航到会员套餐页面
3. 验证所有支付相关文本是否为中文
4. 切换应用语言为英文
5. 刷新会员套餐页面
6. 验证所有支付相关文本是否为英文

**预期结果：**
- 支付页面所有文本（套餐名称、价格描述、按钮等）应正确显示为所选语言
- 错误提示和成功消息也应显示为正确的语言

### React Admin管理后台多语言测试

#### 测试用例3：后台语言切换功能
**测试步骤：**
1. 打开React Admin管理后台
2. 点击右上角的语言切换按钮
3. 选择"English"
4. 验证后台界面是否切换为英文
5. 再次点击语言切换按钮，选择"中文"
6. 验证后台界面是否切换回中文

**预期结果：**
- 后台界面所有文本应正确切换到所选语言
- 菜单项、表单标签、按钮等应显示为正确的语言
- 数据表格中的列标题也应显示为正确的语言

#### 测试用例4：支付管理多语言测试
**测试步骤：**
1. 确保后台语言为中文
2. 导航到会员套餐管理页面
3. 验证所有支付管理相关文本是否为中文
4. 切换后台语言为英文
5. 刷新会员套餐管理页面
6. 验证所有支付管理相关文本是否为英文

**预期结果：**
- 支付管理页面所有文本应正确显示为所选语言
- 表格列标题、操作按钮、提示信息等应显示为正确的语言

### 后端API多语言测试

#### 测试用例5：API响应语言测试
**测试步骤：**
1. 使用API测试工具（如Postman）
2. 发送请求到会员套餐API，不设置Accept-Language头
3. 验证响应是否为中文
4. 发送请求到会员套餐API，设置Accept-Language头为en
5. 验证响应是否为英文
6. 发送请求到会员套餐API，设置Accept-Language头为zh
7. 验证响应是否为中文

**预期结果：**
- 未设置Accept-Language头时，默认响应应为中文
- 设置Accept-Language头为en时，响应应为英文
- 设置Accept-Language头为zh时，响应应为中文
- 错误消息也应根据Accept-Language头返回相应语言

## 支付功能测试

### Flutter移动端支付测试

#### 测试用例6：会员套餐选择和支付流程
**测试步骤：**
1. 登录Flutter应用
2. 导航到会员套餐页面
3. 选择一个会员套餐
4. 选择支付方式（如Stripe）
5. 输入有效的支付信息
6. 确认支付
7. 验证支付结果

**预期结果：**
- 应能成功选择会员套餐
- 应能选择支付方式
- 支付成功后应显示成功消息
- 用户订阅状态应更新为活跃状态
- 应能查看支付历史记录

#### 测试用例7：支付失败处理
**测试步骤：**
1. 登录Flutter应用
2. 导航到会员套餐页面
3. 选择一个会员套餐
4. 选择支付方式
5. 输入无效的支付信息
6. 确认支付
7. 验证支付失败处理

**预期结果：**
- 应显示支付失败消息
- 用户订阅状态不应更新
- 应能重新尝试支付
- 错误消息应清晰明了

#### 测试用例8：优惠券使用测试
**测试步骤：**
1. 登录Flutter应用
2. 导航到会员套餐页面
3. 选择一个会员套餐
4. 输入有效的优惠券代码
5. 验证折扣是否正确应用
6. 完成支付流程

**预期结果：**
- 应能成功应用优惠券折扣
- 最终支付金额应为原价减去折扣
- 支付成功后应显示成功消息
- 优惠券状态应更新为已使用

#### 测试用例9：退款申请测试
**测试步骤：**
1. 登录Flutter应用
2. 导航到支付历史页面
3. 选择一笔已完成的支付
4. 点击申请退款
5. 输入退款原因
6. 提交退款申请
7. 验证退款申请状态

**预期结果：**
- 应能成功提交退款申请
- 应显示退款申请已提交的消息
- 退款状态应更新为处理中
- 管理员应能查看退款申请

### React Admin管理后台支付测试

#### 测试用例10：会员套餐管理测试
**测试步骤：**
1. 登录React Admin管理后台
2. 导航到会员套餐管理页面
3. 点击"创建新套餐"按钮
4. 填写套餐信息（名称、价格、期限等）
5. 点击保存
6. 验证套餐是否创建成功

**预期结果：**
- 应能成功创建新套餐
- 套餐列表中应显示新创建的套餐
- 应能编辑和删除套餐
- 套餐状态应能正确更新

#### 测试用例11：用户订阅管理测试
**测试步骤：**
1. 登录React Admin管理后台
2. 导航到用户订阅管理页面
3. 查看用户订阅列表
4. 选择一个活跃订阅
5. 点击取消订阅
6. 验证订阅状态是否更新

**预期结果：**
- 应能查看所有用户订阅
- 应能取消用户订阅
- 订阅状态应正确更新
- 应能查看订阅详情

#### 测试用例12：支付历史管理测试
**测试步骤：**
1. 登录React Admin管理后台
2. 导航到支付历史页面
3. 查看支付记录列表
4. 筛选特定状态的支付
5. 查看支付详情

**预期结果：**
- 应能查看所有支付记录
- 应能按状态筛选支付
- 应能查看支付详情
- 应能处理退款申请

### 后端API支付测试

#### 测试用例13：支付API测试
**测试步骤：**
1. 使用API测试工具
2. 发送POST请求到/api/v1/payments/create
3. 包含有效的支付信息
4. 验证响应状态和内容

**预期结果：**
- 应返回成功状态
- 应返回订单ID和支付意图ID
- 应能使用支付意图ID完成支付

#### 测试用例14：支付确认API测试
**测试步骤：**
1. 使用API测试工具
2. 发送POST请求到/api/v1/payments/confirm
3. 包含有效的订单ID和支付意图ID
4. 验证响应状态和内容

**预期结果：**
- 应返回支付确认结果
- 支付成功时应创建用户订阅
- 支付失败时应返回错误信息

#### 测试用例15：退款API测试
**测试步骤：**
1. 使用API测试工具
2. 发送POST请求到/api/v1/refunds/request
3. 包含有效的订单ID和退款原因
4. 验证响应状态和内容

**预期结果：**
- 应返回退款申请状态
- 退款申请应成功创建
- 应能查询退款状态

## 综合测试

### 测试用例16：完整支付流程测试
**测试步骤：**
1. 用户在Flutter应用中购买会员套餐
2. 管理员在React Admin后台查看订单
3. 管理员在React Admin后台处理退款
4. 用户在Flutter应用中查看退款状态

**预期结果：**
- 整个支付流程应正常工作
- 各系统间数据应保持一致
- 状态更新应及时反映

### 测试用例17：多语言支付流程测试
**测试步骤：**
1. 将Flutter应用语言设置为英文
2. 用户完成支付流程
3. 将React Admin后台语言设置为中文
4. 管理员查看订单和支付历史

**预期结果：**
- 用户界面应显示为英文
- 管理员界面应显示为中文
- 支付数据应保持一致
- 各语言下的错误消息应正确显示

## 测试报告模板

### 测试环境
- 设备：[设备型号和操作系统]
- 应用版本：[应用版本号]
- 后端版本：[后端版本号]
- 测试日期：[测试日期]

### 测试结果记录
| 测试用例 | 测试结果 | 问题描述 | 严重程度 | 状态 |
|---------|---------|---------|---------|------|
|         |         |         |         |      |

### 测试结论
- 通过的测试用例数：[数量]
| 失败的测试用例数：[数量]
| 阻塞的测试用例数：[数量]
| 测试覆盖率：[百分比]

### 建议和改进
- [测试中发现的问题和建议]

## 自动化测试

### 单元测试
- 多语言翻译函数测试
- 支付计算逻辑测试
- 优惠券验证逻辑测试

### 集成测试
- 支付API集成测试
- 多语言API集成测试
- 数据库操作测试

### 端到端测试
- 支付流程端到端测试
- 多语言切换端到端测试
- 用户订阅管理端到端测试

## 测试工具和环境

### 测试工具
- Flutter测试框架
- React Admin测试工具
- Postman（API测试）
- Jest（单元测试）
- Cypress（端到端测试）

### 测试环境
- 开发环境
- 测试环境
- 预生产环境
- 生产环境

## 注意事项

1. 在测试支付功能时，使用测试支付网关，避免实际扣费
2. 测试多语言功能时，确保所有语言的翻译都正确显示
3. 测试退款功能时，确保退款流程符合业务规则
4. 测试API时，确保请求头和参数正确设置
5. 测试数据管理时，确保测试数据与生产数据隔离

## 总结

本测试指南涵盖了八字算命应用多语言支持和支付系统的所有主要功能。通过执行这些测试用例，可以确保系统的稳定性、可靠性和用户体验。建议在每次发布前都执行完整的测试流程，以确保新功能不会影响现有功能。